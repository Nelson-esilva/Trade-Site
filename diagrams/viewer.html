<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trade Site - Visualizador de Diagramas</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 1.1em;
        }
        .nav {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
        }
        .nav-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }
        .nav-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
            font-size: 14px;
        }
        .nav-button:hover {
            background: #0056b3;
        }
        .nav-button.active {
            background: #28a745;
        }
        .content {
            padding: 30px;
        }
        .diagram-container {
            display: none;
            text-align: center;
        }
        .diagram-container.active {
            display: block;
        }
        .diagram-title {
            font-size: 1.8em;
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #007bff;
        }
        .diagram-description {
            color: #666;
            margin-bottom: 30px;
            line-height: 1.6;
        }
        .mermaid {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        .info-box h4 {
            margin: 0 0 10px 0;
            color: #1976d2;
        }
        .info-box p {
            margin: 0;
            color: #424242;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèóÔ∏è Trade Site</h1>
            <p>Visualizador de Diagramas da Arquitetura</p>
        </div>
        
        <div class="nav">
            <div class="nav-buttons">
                <button class="nav-button active" onclick="showDiagram('architecture')">Arquitetura Geral</button>
                <button class="nav-button" onclick="showDiagram('database')">Schema do Banco</button>
                <button class="nav-button" onclick="showDiagram('user-flow')">Fluxo do Usu√°rio</button>
                <button class="nav-button" onclick="showDiagram('permissions')">Sistema de Permiss√µes</button>
                <button class="nav-button" onclick="showDiagram('api')">Endpoints da API</button>
                <button class="nav-button" onclick="showDiagram('docker')">Arquitetura Docker</button>
                <button class="nav-button" onclick="showDiagram('offer-workflow')">Fluxo de Ofertas</button>
                <button class="nav-button" onclick="showDiagram('components')">Hierarquia de Componentes</button>
                <button class="nav-button" onclick="showDiagram('state')">Gerenciamento de Estado</button>
            </div>
        </div>
        
        <div class="content">
            <!-- Arquitetura Geral -->
            <div id="architecture" class="diagram-container active">
                <h2 class="diagram-title">üèóÔ∏è Arquitetura Geral do Sistema</h2>
                <p class="diagram-description">
                    Vis√£o geral da arquitetura do Trade Site, mostrando a intera√ß√£o entre frontend React, 
                    backend Django, banco de dados PostgreSQL e infraestrutura Docker.
                </p>
                <div class="mermaid">
graph TB
    subgraph "Frontend (React)"
        A[Home Page]
        B[Item Details]
        C[Create Item]
        D[My Items]
        E[My Offers]
        F[Profile]
        G[Login/Register]
    end
    
    subgraph "Backend (Django)"
        H[API Gateway]
        I[Items API]
        J[Offers API]
        K[Users API]
        L[Auth API]
    end
    
    subgraph "Database"
        M[(PostgreSQL)]
        N[Users Table]
        O[Items Table]
        P[Offers Table]
    end
    
    subgraph "Infrastructure"
        Q[Docker Compose]
        R[Frontend Container]
        S[Backend Container]
        T[Database Container]
    end
    
    A --> H
    B --> H
    C --> H
    D --> H
    E --> H
    F --> H
    G --> H
    
    H --> I
    H --> J
    H --> K
    H --> L
    
    I --> M
    J --> M
    K --> M
    L --> M
    
    M --> N
    M --> O
    M --> P
    
    Q --> R
    Q --> S
    Q --> T
    
    R --> A
    S --> H
    T --> M
    
    style A fill:#e1f5fe
    style B fill:#e1f5fe
    style C fill:#e1f5fe
    style D fill:#e1f5fe
    style E fill:#e1f5fe
    style F fill:#e1f5fe
    style G fill:#e1f5fe
    style H fill:#f3e5f5
    style I fill:#f3e5f5
    style J fill:#f3e5f5
    style K fill:#f3e5f5
    style L fill:#f3e5f5
    style M fill:#e8f5e8
    style N fill:#e8f5e8
    style O fill:#e8f5e8
    style P fill:#e8f5e8
                </div>
            </div>
            
            <!-- Schema do Banco -->
            <div id="database" class="diagram-container">
                <h2 class="diagram-title">üóÑÔ∏è Schema do Banco de Dados</h2>
                <p class="diagram-description">
                    Diagrama ER (Entity-Relationship) mostrando as tabelas principais e seus relacionamentos 
                    no banco de dados PostgreSQL.
                </p>
                <div class="mermaid">
graph TD
    subgraph Database["Banco de Dados PostgreSQL"]
        subgraph UserTable["Tabela: User"]
            U1["id (PK)"]
            U2["username"]
            U3["email"]
            U4["name"]
            U5["is_trade_admin"]
        end
        
        subgraph ItemTable["Tabela: Item"]
            I1["id (PK)"]
            I2["title"]
            I3["description"]
            I4["category"]
            I5["status"]
            I6["owner_id (FK)"]
        end
        
        subgraph OfferTable["Tabela: Offer"]
            O1["id (PK)"]
            O2["item_desired_id (FK)"]
            O3["item_offered_id (FK)"]
            O4["offerer_id (FK)"]
            O5["offer_type"]
            O6["status"]
        end
    end
    
    U1 --> I6
    U1 --> O4
    I1 --> O2
    I1 --> O3
    
    style U1 fill:#e3f2fd
    style I1 fill:#e8f5e8
    style O1 fill:#fff3e0
                </div>
            </div>
            
            <!-- Fluxo do Usu√°rio -->
            <div id="user-flow" class="diagram-container">
                <h2 class="diagram-title">üë§ Fluxo do Usu√°rio</h2>
                <p class="diagram-description">
                    Fluxo completo de intera√ß√£o do usu√°rio com o sistema, desde o acesso inicial 
                    at√© a conclus√£o de uma troca.
                </p>
                <div class="mermaid">
flowchart TD
    A[Usu√°rio Acessa Site] --> B{Est√° Logado?}
    B -->|N√£o| C[P√°gina de Login/Registro]
    B -->|Sim| D[Home Page]
    
    C --> E[Login/Registro]
    E --> F{Sucesso?}
    F -->|N√£o| C
    F -->|Sim| D
    
    D --> G[Visualizar Itens]
    G --> H[Clicar em Item]
    H --> I[Detalhes do Item]
    
    I --> J{√â o Dono?}
    J -->|Sim| K[Editar/Excluir Item]
    J -->|N√£o| L[Fazer Oferta]
    
    L --> M{Tipo de Oferta}
    M -->|Item| N[Selecionar Item para Troca]
    M -->|Dinheiro| O[Inserir Valor]
    
    N --> P[Enviar Oferta]
    O --> P
    P --> Q[Oferta Enviada]
    
    Q --> R[Notifica√ß√£o para Dono]
    R --> S[Dono Recebe Oferta]
    S --> T{Aceitar/Recusar}
    T -->|Aceitar| U[Item Fica Indispon√≠vel]
    T -->|Recusar| V[Item Continua Dispon√≠vel]
    
    U --> W[Oferta Vai para Hist√≥rico]
    V --> W
    
    K --> X[Atualizar Item]
    X --> D
    
    style A fill:#e3f2fd
    style D fill:#e8f5e8
    style I fill:#fff3e0
    style P fill:#f3e5f5
    style U fill:#e8f5e8
    style V fill:#ffebee
                </div>
            </div>
            
            <!-- Sistema de Permiss√µes -->
            <div id="permissions" class="diagram-container">
                <h2 class="diagram-title">üîê Sistema de Permiss√µes</h2>
                <p class="diagram-description">
                    Estrutura hier√°rquica de permiss√µes, mostrando os diferentes n√≠veis de acesso 
                    e suas respectivas capacidades no sistema.
                </p>
                <div class="mermaid">
graph TD
    subgraph Niveis["N√≠veis de Permiss√£o"]
        A["Usu√°rio N√£o Autenticado"]
        B["Usu√°rio Comum"]
        C["Trade Admin"]
        D["Superusu√°rio"]
    end
    
    subgraph Leitura["Permiss√µes de Leitura"]
        E["Visualizar Itens Dispon√≠veis"]
        F["Visualizar Detalhes do Item"]
        G["Visualizar Pr√≥prios Itens"]
        H["Visualizar Todos os Itens"]
    end
    
    subgraph Escrita["Permiss√µes de Escrita"]
        I["Criar Item"]
        J["Editar Pr√≥prio Item"]
        K["Excluir Pr√≥prio Item"]
        L["Editar Qualquer Item"]
        M["Excluir Qualquer Item"]
    end
    
    subgraph Ofertas["Permiss√µes de Ofertas"]
        N["Fazer Ofertas"]
        O["Gerenciar Pr√≥prias Ofertas"]
        P["Aceitar/Recusar Ofertas dos Pr√≥prios Itens"]
        Q["Aceitar/Recusar Qualquer Oferta"]
    end
    
    subgraph Admin["Permiss√µes Administrativas"]
        R["Alterar Status de Itens"]
        S["Gerenciar Usu√°rios"]
        T["Acesso Total ao Sistema"]
    end
    
    A --> E
    A --> F
    
    B --> E
    B --> F
    B --> G
    B --> I
    B --> J
    B --> K
    B --> N
    B --> O
    B --> P
    
    C --> E
    C --> F
    C --> G
    C --> H
    C --> I
    C --> J
    C --> K
    C --> L
    C --> N
    C --> O
    C --> P
    C --> Q
    C --> R
    
    D --> E
    D --> F
    D --> G
    D --> H
    D --> I
    D --> J
    D --> K
    D --> L
    D --> M
    D --> N
    D --> O
    D --> P
    D --> Q
    D --> R
    D --> S
    D --> T
    
    style A fill:#ffebee
    style B fill:#e8f5e8
    style C fill:#fff3e0
    style D fill:#e3f2fd
                </div>
            </div>
            
            <!-- Endpoints da API -->
            <div id="api" class="diagram-container">
                <h2 class="diagram-title">üîå Endpoints da API</h2>
                <p class="diagram-description">
                    Mapa completo dos endpoints da API REST, mostrando as rotas dispon√≠veis 
                    e suas interconex√µes.
                </p>
                <div class="mermaid">
graph TB
    subgraph Auth["Autentica√ß√£o"]
        A1["POST /api/auth/login/"]
        A2["POST /api/auth/register/"]
    end
    
    subgraph Users["Usu√°rios"]
        U1["GET /api/users/"]
        U2["GET /api/users/me/"]
        U3["GET /api/users/{id}/"]
    end
    
    subgraph Items["Itens"]
        I1["GET /api/items/"]
        I2["POST /api/items/"]
        I3["GET /api/items/{id}/"]
        I4["PUT /api/items/{id}/"]
        I5["PATCH /api/items/{id}/"]
        I6["DELETE /api/items/{id}/"]
        I7["PATCH /api/items/{id}/change_status/"]
    end
    
    subgraph Offers["Ofertas"]
        O1["GET /api/offers/"]
        O2["POST /api/offers/"]
        O3["GET /api/offers/{id}/"]
        O4["POST /api/offers/{id}/accept/"]
        O5["POST /api/offers/{id}/refuse/"]
    end
    
    subgraph Filters["Filtros e Busca"]
        F1["?search=termo"]
        F2["?category=livros"]
        F3["?status=disponivel"]
        F4["?ordering=-created_at"]
    end
    
    A1 --> U2
    A2 --> U2
    U2 --> I1
    U2 --> I2
    U2 --> O1
    U2 --> O2
    
    I1 --> F1
    I1 --> F2
    I1 --> F3
    I1 --> F4
    
    I2 --> I3
    I3 --> I4
    I3 --> I5
    I3 --> I6
    I3 --> I7
    
    O2 --> O3
    O3 --> O4
    O3 --> O5
    
    style A1 fill:#e8f5e8
    style A2 fill:#e8f5e8
    style U2 fill:#e3f2fd
    style I1 fill:#fff3e0
    style I2 fill:#fff3e0
    style O1 fill:#f3e5f5
    style O2 fill:#f3e5f5
                </div>
            </div>
            
            <!-- Arquitetura Docker -->
            <div id="docker" class="diagram-container">
                <h2 class="diagram-title">üê≥ Arquitetura Docker</h2>
                <p class="diagram-description">
                    Estrutura de containers Docker e como eles se comunicam, 
                    incluindo portas e volumes.
                </p>
                <div class="mermaid">
graph TB
    subgraph Docker["Docker Compose"]
        subgraph Frontend["Frontend Container"]
            F1["React App"]
            F2["Nginx"]
            F3["Port 3000"]
        end
        
        subgraph Backend["Backend Container"]
            B1["Django App"]
            B2["Gunicorn"]
            B3["Port 8000"]
        end
        
        subgraph Database["Database Container"]
            D1["PostgreSQL"]
            D2["Port 5432"]
            D3["Data Volume"]
        end
    end
    
    subgraph Host["Host Machine"]
        H1["Port 3000"]
        H2["Port 8000"]
        H3["Docker Volumes"]
    end
    
    subgraph External["External Access"]
        E1["Browser"]
        E2["API Clients"]
    end
    
    F1 --> F2
    F2 --> F3
    F3 --> H1
    H1 --> E1
    
    B1 --> B2
    B2 --> B3
    B3 --> H2
    H2 --> E2
    
    D1 --> D2
    D1 --> D3
    D3 --> H3
    
    B1 --> D1
    F1 --> B1
    
    style F1 fill:#e1f5fe
    style B1 fill:#f3e5f5
    style D1 fill:#e8f5e8
    style E1 fill:#fff3e0
    style E2 fill:#fff3e0
                </div>
            </div>
            
            <!-- Fluxo de Ofertas -->
            <div id="offer-workflow" class="diagram-container">
                <h2 class="diagram-title">üîÑ Fluxo de Ofertas</h2>
                <p class="diagram-description">
                    Sequ√™ncia detalhada de como uma oferta √© criada, processada e finalizada 
                    no sistema.
                </p>
                <div class="mermaid">
sequenceDiagram
    participant U1 as Usu√°rio A
    participant U2 as Usu√°rio B
    participant API as Backend API
    participant DB as Database
    
    Note over U1,DB: Fluxo de Oferta de Troca
    
    U1->>API: GET /api/items/
    API->>DB: Buscar itens dispon√≠veis
    DB-->>API: Lista de itens
    API-->>U1: Itens dispon√≠veis
    
    U1->>API: GET /api/items/{id}/
    API->>DB: Buscar detalhes do item
    DB-->>API: Detalhes do item
    API-->>U1: Detalhes do item
    
    U1->>API: POST /api/offers/
    Note right of U1: {item_desired: X, item_offered: Y, offer_type: "item"}
    API->>DB: Validar oferta
    API->>DB: Criar oferta
    DB-->>API: Oferta criada
    API-->>U1: Oferta enviada
    
    Note over U2,DB: Notifica√ß√£o para o dono do item
    
    U2->>API: GET /api/offers/
    API->>DB: Buscar ofertas recebidas
    DB-->>API: Ofertas recebidas
    API-->>U2: Lista de ofertas
    
    U2->>API: POST /api/offers/{id}/accept/
    API->>DB: Atualizar status da oferta
    API->>DB: Marcar itens como indispon√≠veis
    DB-->>API: Atualiza√ß√µes realizadas
    API-->>U2: Oferta aceita
    
    Note over U1,DB: Notifica√ß√£o para o ofertante
    
    U1->>API: GET /api/offers/
    API->>DB: Buscar ofertas enviadas
    DB-->>API: Ofertas enviadas
    API-->>U1: Oferta aceita
                </div>
            </div>
            
            <!-- Hierarquia de Componentes -->
            <div id="components" class="diagram-container">
                <h2 class="diagram-title">‚öõÔ∏è Hierarquia de Componentes React</h2>
                <p class="diagram-description">
                    Estrutura hier√°rquica dos componentes React, mostrando como eles se relacionam 
                    e se comunicam atrav√©s do Context API.
                </p>
                <div class="mermaid">
graph TD
    subgraph App["App.jsx"]
        A["App Component"]
    end
    
    subgraph Layout["Layout"]
        B["Layout Component"]
        C["Header Component"]
        D["Footer Component"]
    end
    
    subgraph Pages["Pages"]
        E["Home Page"]
        F["ItemDetails Page"]
        G["CreateItem Page"]
        H["MyItems Page"]
        I["MyOffers Page"]
        J["Profile Page"]
        K["Login Page"]
        L["Register Page"]
    end
    
    subgraph Components["Components"]
        M["ItemCard Component"]
        N["ProtectedRoute Component"]
        O["ProfileProtection Component"]
        P["ImageEditModal Component"]
    end
    
    subgraph Context["Context"]
        Q["AppContext"]
        R["useApp Hook"]
    end
    
    subgraph Services["Services"]
        S["ApiService"]
        T["Theme"]
    end
    
    A --> B
    B --> C
    B --> D
    
    A --> E
    A --> F
    A --> G
    A --> H
    A --> I
    A --> J
    A --> K
    A --> L
    
    E --> M
    F --> M
    H --> M
    H --> P
    
    A --> N
    A --> O
    
    E --> Q
    F --> Q
    G --> Q
    H --> Q
    I --> Q
    J --> Q
    K --> Q
    L --> Q
    
    Q --> R
    R --> S
    
    A --> T
    
    style A fill:#e3f2fd
    style B fill:#e8f5e8
    style E fill:#fff3e0
    style F fill:#fff3e0
    style G fill:#fff3e0
    style H fill:#fff3e0
    style I fill:#fff3e0
    style J fill:#fff3e0
    style K fill:#fff3e0
    style L fill:#fff3e0
    style M fill:#f3e5f5
    style N fill:#f3e5f5
    style O fill:#f3e5f5
    style P fill:#f3e5f5
    style Q fill:#ffebee
    style S fill:#e0f2f1
                </div>
            </div>
            
            <!-- Gerenciamento de Estado -->
            <div id="state" class="diagram-container">
                <h2 class="diagram-title">üîÑ Gerenciamento de Estado</h2>
                <p class="diagram-description">
                    Fluxo de dados e gerenciamento de estado usando React Context API, 
                    mostrando como as a√ß√µes afetam o estado global.
                </p>
                <div class="mermaid">
graph TB
    subgraph State["AppContext State"]
        A["user"]
        B["isAuthenticated"]
        C["items"]
        D["offers"]
        E["loading"]
        F["error"]
        G["notifications"]
    end
    
    subgraph Actions["Actions"]
        H["LOGIN_SUCCESS"]
        I["LOGOUT"]
        J["SET_ITEMS"]
        K["ADD_ITEM"]
        L["UPDATE_ITEM"]
        M["REMOVE_ITEM"]
        N["SET_OFFERS"]
        O["ADD_OFFER"]
        P["UPDATE_OFFER"]
        Q["SET_LOADING"]
        R["SET_ERROR"]
        S["ADD_NOTIFICATION"]
    end
    
    subgraph API["API Calls"]
        T["loadItems"]
        U["loadOffers"]
        V["createItem"]
        W["createOffer"]
        X["acceptOffer"]
        Y["refuseOffer"]
        Z["login"]
        AA["logout"]
    end
    
    subgraph Components["Components"]
        BB["Home"]
        CC["ItemDetails"]
        DD["MyItems"]
        EE["MyOffers"]
        FF["Login"]
        GG["Register"]
    end
    
    H --> A
    H --> B
    I --> A
    I --> B
    
    J --> C
    K --> C
    L --> C
    M --> C
    
    N --> D
    O --> D
    P --> D
    
    Q --> E
    R --> F
    S --> G
    
    T --> J
    U --> N
    V --> K
    W --> O
    X --> P
    Y --> P
    Z --> H
    AA --> I
    
    BB --> T
    BB --> C
    CC --> T
    CC --> C
    DD --> T
    DD --> C
    EE --> U
    EE --> D
    FF --> Z
    GG --> Z
    
    style A fill:#e3f2fd
    style B fill:#e3f2fd
    style C fill:#e8f5e8
    style D fill:#e8f5e8
    style E fill:#fff3e0
    style F fill:#ffebee
    style G fill:#f3e5f5
                </div>
            </div>
            
            <div class="info-box">
                <h4>üí° Como usar este visualizador</h4>
                <p>
                    Use os bot√µes de navega√ß√£o acima para alternar entre os diferentes diagramas. 
                    Cada diagrama mostra uma perspectiva espec√≠fica da arquitetura do Trade Site. 
                    Voc√™ pode usar este arquivo HTML em qualquer navegador para visualizar os diagramas.
                </p>
            </div>
        </div>
    </div>

    <script>
        // Inicializar Mermaid
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true
            },
            sequence: {
                useMaxWidth: true
            },
            er: {
                useMaxWidth: true
            }
        });

        // Fun√ß√£o para mostrar diagrama espec√≠fico
        function showDiagram(diagramId) {
            // Esconder todos os diagramas
            const containers = document.querySelectorAll('.diagram-container');
            containers.forEach(container => {
                container.classList.remove('active');
            });
            
            // Remover classe active de todos os bot√µes
            const buttons = document.querySelectorAll('.nav-button');
            buttons.forEach(button => {
                button.classList.remove('active');
            });
            
            // Mostrar diagrama selecionado
            document.getElementById(diagramId).classList.add('active');
            
            // Adicionar classe active ao bot√£o clicado
            event.target.classList.add('active');
            
            // Re-renderizar Mermaid para o diagrama ativo
            mermaid.init();
        }
    </script>
</body>
</html>
